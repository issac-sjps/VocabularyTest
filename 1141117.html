<!doctype html>
<html lang="zh-TW">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è‹±æ–‡å–®å­—æ¸¬é©—ç³»çµ±</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        .letter-card {
            transition: all 0.3s ease;
            user-select: none;
        }
        
        .letter-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .letter-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }
        
        .answer-area.drag-over {
            background-color: #dcfce7 !important;
            border-color: #16a34a !important;
            transform: scale(1.02);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .bounce {
            animation: bounce 0.6s ease-in-out;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="min-h-full bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500">
  <div class="container mx-auto max-w-4xl bg-white rounded-3xl shadow-2xl overflow-hidden"><!-- æ¨™é¡Œå€åŸŸ -->
   <header class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-8 text-center relative">
    <div class="absolute top-4 right-4 hidden" id="headerButtons"><button onclick="showHome()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-full text-sm mr-2 transition-all"> ğŸ  é¦–é  </button> <button onclick="restartQuiz()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-full text-sm transition-all"> ğŸ”„ é‡æ–°é–‹å§‹ </button>
    </div>
    <h1 class="text-4xl font-bold mb-2" id="pageTitle">è‹±æ–‡å–®å­—æ¸¬é©—ç³»çµ±</h1>
    <div class="w-full bg-white/20 rounded-full h-2 mt-4 hidden" id="progressContainer">
     <div class="bg-white h-2 rounded-full transition-all duration-500" id="progressBar" style="width: 0%"></div>
    </div>
   </header><!-- é¦–é  -->
   <div class="p-8 text-center" id="homePage">
    <h2 class="text-3xl font-bold text-gray-800 mb-8">æ­¡è¿ä¾†åˆ°è‹±æ–‡å–®å­—æ¸¬é©—</h2>
    <div class="grid md:grid-cols-3 gap-6 mb-8">
     <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-2xl border-2 border-blue-200 hover:border-blue-400 transition-all hover:transform hover:scale-105">
      <div class="text-3xl font-bold text-blue-600 mb-2">
       1-5
      </div>
      <div class="text-xl font-semibold mb-2">
       è‹±æ–‡é¸ä¸­æ–‡
      </div>
      <div class="text-gray-600">
       çœ‹è‹±æ–‡å–®å­—ï¼Œé¸æ“‡æ­£ç¢ºçš„ä¸­æ–‡æ„æ€
      </div>
     </div>
     <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-2xl border-2 border-green-200 hover:border-green-400 transition-all hover:transform hover:scale-105">
      <div class="text-3xl font-bold text-green-600 mb-2">
       6-10
      </div>
      <div class="text-xl font-semibold mb-2">
       ä¸­æ–‡é¸è‹±æ–‡
      </div>
      <div class="text-gray-600">
       çœ‹ä¸­æ–‡æ„æ€ï¼Œé¸æ“‡æ­£ç¢ºçš„è‹±æ–‡å–®å­—
      </div>
     </div>
     <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-2xl border-2 border-purple-200 hover:border-purple-400 transition-all hover:transform hover:scale-105">
      <div class="text-3xl font-bold text-purple-600 mb-2">
       11-15
      </div>
      <div class="text-xl font-semibold mb-2">
       æ‹–æ‹‰æ‹¼å­—
      </div>
      <div class="text-gray-600">
       æ‹–æ‹‰å­—æ¯å¡ç‰‡æ‹¼å‡ºæ­£ç¢ºå–®å­—
      </div>
     </div>
    </div><button onclick="startQuiz()" class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full text-xl transition-all transform hover:scale-105 shadow-lg"> ğŸš€ é–‹å§‹æ¸¬é©— (15é¡Œ) </button>
    <div class="mt-6"><button onclick="showTeacherPanel()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-full transition-all"> ğŸ‘¨â€ğŸ« æ•™å¸«ç®¡ç†å€ </button>
    </div>
   </div><!-- æ•™å¸«ç®¡ç†å€ -->
   <div class="p-8 hidden" id="teacherPanel">
    <h2 class="text-3xl font-bold text-gray-800 mb-6">æ•™å¸«ç®¡ç†å€</h2>
    <div class="bg-gray-50 rounded-2xl p-6 mb-6">
     <h3 class="text-xl font-bold text-gray-700 mb-4">ğŸ“š å–®å­—åº«</h3>
     <div class="grid gap-3" id="vocabList"><!-- å–®å­—åˆ—è¡¨æœƒå‹•æ…‹ç”Ÿæˆ -->
     </div>
    </div><button onclick="showHome()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-full transition-all"> è¿”å›é¦–é  </button>
   </div><!-- æ¸¬é©—å€åŸŸ -->
   <div class="p-8 hidden" id="quizArea">
    <div class="text-center mb-6">
     <div class="text-lg text-gray-600 mb-2" id="questionCounter">
      ç¬¬ 1 é¡Œ / 15 é¡Œ
     </div>
     <div class="text-sm text-gray-500" id="stageInfo">
      éšæ®µä¸€ï¼šè‹±æ–‡é¸ä¸­æ–‡
     </div>
    </div><!-- é¡Œç›®é¡¯ç¤º -->
    <div class="text-center mb-8">
     <div class="flex items-center justify-center gap-4 mb-4">
      <div class="text-5xl font-bold text-gray-800" id="questionWord">
       beautiful
      </div><button onclick="speakWord()" class="bg-blue-500 hover:bg-blue-600 text-white w-12 h-12 rounded-full flex items-center justify-center transition-all hover:scale-110"> ğŸ”Š </button>
     </div>
    </div><!-- é¸æ“‡é¡Œé¸é … -->
    <div class="grid grid-cols-2 gap-4 max-w-2xl mx-auto mb-8" id="optionsContainer"><!-- é¸é …æœƒå‹•æ…‹ç”Ÿæˆ -->
    </div><!-- ç­”é¡Œçµæœè¨Šæ¯ -->
    <div class="text-center mb-6 hidden" id="feedbackMessage"><!-- ç­”é¡Œçµæœæœƒå‹•æ…‹é¡¯ç¤º -->
    </div><!-- æ‹–æ‹‰æ‹¼å­—å€åŸŸ -->
    <div class="max-w-3xl mx-auto hidden" id="spellingContainer">
     <div class="text-center mb-6">
      <div class="text-lg font-bold text-gray-700 mb-2">
       æ‹–æ‹‰å­—æ¯å¡ç‰‡ä¾†æ‹¼å‡ºå–®å­—ï¼š
      </div>
      <div class="text-sm text-blue-600 mb-2">
       ğŸ’¡ æç¤ºï¼šé€™å€‹å–®å­—ç¸½å…±æœ‰ <span id="letterCount" class="font-bold">0</span> å€‹å­—æ¯
      </div>
      <div class="text-sm text-green-600 font-bold">
       ç›®å‰å·²é¸ï¼š<span id="selectedCount" class="font-bold">0</span> å€‹å­—æ¯
      </div>
     </div><!-- ç­”æ¡ˆå€åŸŸ -->
     <div id="answerArea" class="answer-area min-h-20 bg-gray-50 border-3 border-dashed border-gray-300 rounded-2xl p-6 mb-6 flex items-center justify-center gap-2 flex-wrap transition-all">
      <div class="text-gray-400 text-lg">
       å°‡å­—æ¯å¡ç‰‡æ‹–æ‹‰åˆ°é€™è£¡
      </div>
     </div><!-- å­—æ¯å¡ç‰‡å€åŸŸ -->
     <div class="text-center mb-4">
      <div class="text-sm text-gray-600 mb-3">
       å¯ç”¨å­—æ¯ï¼š
      </div>
      <div id="letterCards" class="flex flex-wrap gap-3 justify-center mb-6"><!-- å­—æ¯å¡ç‰‡æœƒå‹•æ…‹ç”Ÿæˆ -->
      </div>
     </div>
     <div class="flex gap-4 justify-center"><button onclick="clearAnswer()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-xl transition-all"> ğŸ—‘ï¸ æ¸…é™¤ </button> <button onclick="checkSpelling()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl transition-all" id="checkBtn"> âœ… ç¢ºèªç­”æ¡ˆ </button>
     </div>
    </div><!-- ä¸‹ä¸€é¡ŒæŒ‰éˆ• -->
    <div class="text-center mt-8"><button onclick="nextQuestion()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-xl transition-all hidden" id="nextBtn"> â¡ï¸ ä¸‹ä¸€é¡Œ </button>
    </div>
   </div><!-- çµæœé é¢ -->
   <div class="p-8 text-center hidden" id="resultsPage">
    <div class="mb-8">
     <div class="text-6xl mb-4">
      ğŸ‰
     </div>
     <h2 class="text-4xl font-bold text-gray-800 mb-4">æ¸¬é©—å®Œæˆï¼</h2>
     <div class="text-6xl font-bold text-green-600 mb-2" id="finalScore">
      15/15
     </div>
     <div class="text-xl text-gray-600" id="scoreMessage">
      æ­å–œï¼å…¨éƒ¨ç­”å°äº†ï¼
     </div>
    </div>
    <div class="bg-gray-50 rounded-2xl p-6 mb-8">
     <h3 class="text-xl font-bold text-gray-700 mb-4">ğŸ“Š è©³ç´°æˆç¸¾</h3>
     <div class="grid grid-cols-3 gap-4" id="stageScores"><!-- å„éšæ®µæˆç¸¾æœƒå‹•æ…‹ç”Ÿæˆ -->
     </div>
    </div>
    <div class="flex gap-4 justify-center"><button onclick="restartQuiz()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl transition-all"> ğŸ”„ é‡æ–°æ¸¬é©— </button> <button onclick="showHome()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-xl transition-all"> ğŸ  è¿”å›é¦–é  </button>
    </div>
   </div>
  </div><!-- éµç›¤æç¤º -->
  <div class="fixed bottom-4 right-4 bg-black/80 text-white px-4 py-2 rounded-full text-sm backdrop-blur-sm hidden" id="keyboardHint">
   æŒ‰ç©ºç™½éµï¼šä¸‹ä¸€é¡Œ âŒ¨ï¸
  </div><!-- è‡ªå®šç¾©å¯†ç¢¼è¼¸å…¥æ¡† -->
  <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden" id="passwordModal">
   <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
    <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">æ•™å¸«ç®¡ç†å€</h3>
    <p class="text-gray-600 mb-6 text-center">è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼</p>
    <div class="mb-6"><label for="passwordInput" class="block text-sm font-medium text-gray-700 mb-2">å¯†ç¢¼</label> <input type="password" id="passwordInput" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none text-lg" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
    </div>
    <div class="flex gap-3"><button onclick="cancelPassword()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-xl transition-all"> å–æ¶ˆ </button> <button onclick="confirmPassword()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl transition-all"> ç¢ºèª </button>
    </div>
   </div>
  </div>
  <script>
        // å–®å­—åº«
        const vocabulary = [
            { word: 'bowl', meaning: 'ç¢—' },
            { word: 'bread', meaning: 'éºµåŒ…' },
            { word: 'break', meaning: 'æ‰“ç ´' },
            { word: 'bridge', meaning: 'æ©‹' },
            { word: 'bright', meaning: 'æ˜äº®çš„' }
        ];

        // å…¨åŸŸè®Šæ•¸
        let currentQuestionIndex = 0;
        let questions = [];
        let score = 0;
        let stageScores = [0, 0, 0]; // ä¸‰å€‹éšæ®µçš„åˆ†æ•¸
        let selectedAnswer = null;
        let currentAnswer = [];
        let availableLetters = [];

        // é é¢æ§åˆ¶
        function showHome() {
            document.getElementById('homePage').classList.remove('hidden');
            document.getElementById('teacherPanel').classList.add('hidden');
            document.getElementById('quizArea').classList.add('hidden');
            document.getElementById('resultsPage').classList.add('hidden');
            document.getElementById('headerButtons').classList.add('hidden');
            document.getElementById('progressContainer').classList.add('hidden');
            document.getElementById('keyboardHint').classList.add('hidden');
            document.getElementById('pageTitle').textContent = 'è‹±æ–‡å–®å­—æ¸¬é©—ç³»çµ±';
        }

        function showTeacherPanel() {
            // é¡¯ç¤ºè‡ªå®šç¾©å¯†ç¢¼è¼¸å…¥æ¡†
            document.getElementById('passwordModal').classList.remove('hidden');
            document.getElementById('passwordInput').focus();
        }

        function cancelPassword() {
            document.getElementById('passwordModal').classList.add('hidden');
            document.getElementById('passwordInput').value = '';
        }

        function confirmPassword() {
            const password = document.getElementById('passwordInput').value;
            if (password === '000000') {
                document.getElementById('passwordModal').classList.add('hidden');
                document.getElementById('passwordInput').value = '';
                document.getElementById('homePage').classList.add('hidden');
                document.getElementById('teacherPanel').classList.remove('hidden');
                updateVocabList();
            } else {
                // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
                const input = document.getElementById('passwordInput');
                input.style.borderColor = '#ef4444';
                input.value = '';
                input.placeholder = 'å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥';
                setTimeout(() => {
                    input.style.borderColor = '#d1d5db';
                    input.placeholder = 'è«‹è¼¸å…¥å¯†ç¢¼';
                }, 2000);
            }
        }

        function updateVocabList() {
            const vocabList = document.getElementById('vocabList');
            vocabList.innerHTML = '';
            
            vocabulary.forEach((vocab, index) => {
                const item = document.createElement('div');
                item.className = 'flex justify-between items-center bg-white p-3 rounded-lg';
                item.innerHTML = `
                    <span><strong>${vocab.word}</strong> - ${vocab.meaning}</span>
                    <span class="text-sm text-gray-500">#${index + 1}</span>
                `;
                vocabList.appendChild(item);
            });
        }



        // æ¸¬é©—æ§åˆ¶
        function startQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            stageScores = [0, 0, 0];
            selectedAnswer = null;
            
            document.getElementById('homePage').classList.add('hidden');
            document.getElementById('quizArea').classList.remove('hidden');
            document.getElementById('headerButtons').classList.remove('hidden');
            document.getElementById('progressContainer').classList.remove('hidden');
            document.getElementById('keyboardHint').classList.remove('hidden');
            
            generateQuestions();
            displayQuestion();
        }

        function generateQuestions() {
            questions = [];
            
            // æ¯å€‹éšæ®µ5é¡Œï¼Œå…±15é¡Œ
            for (let stage = 1; stage <= 3; stage++) {
                const shuffledVocab = [...vocabulary].sort(() => Math.random() - 0.5).slice(0, 5);
                
                shuffledVocab.forEach(vocab => {
                    const wrongAnswers = vocabulary.filter(v => v.word !== vocab.word)
                        .sort(() => Math.random() - 0.5).slice(0, 3);
                    
                    let options = [];
                    let correctAnswer = '';
                    
                    if (stage === 1) {
                        // è‹±æ–‡é¸ä¸­æ–‡
                        options = [vocab.meaning, ...wrongAnswers.map(v => v.meaning)]
                            .sort(() => Math.random() - 0.5);
                        correctAnswer = vocab.meaning;
                    } else if (stage === 2) {
                        // ä¸­æ–‡é¸è‹±æ–‡
                        options = [vocab.word, ...wrongAnswers.map(v => v.word)]
                            .sort(() => Math.random() - 0.5);
                        correctAnswer = vocab.word;
                    }
                    
                    questions.push({
                        stage: stage,
                        word: vocab.word,
                        meaning: vocab.meaning,
                        options: options,
                        correctAnswer: correctAnswer
                    });
                });
            }
        }

        function displayQuestion() {
            const question = questions[currentQuestionIndex];
            const stage = question.stage;
            
            // æ›´æ–°é€²åº¦
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            
            // æ›´æ–°è¨ˆæ•¸å™¨å’Œéšæ®µè³‡è¨Š
            document.getElementById('questionCounter').textContent = `ç¬¬ ${currentQuestionIndex + 1} é¡Œ / ${questions.length} é¡Œ`;
            
            const stageNames = {
                1: 'éšæ®µä¸€ï¼šè‹±æ–‡é¸ä¸­æ–‡',
                2: 'éšæ®µäºŒï¼šä¸­æ–‡é¸è‹±æ–‡', 
                3: 'éšæ®µä¸‰ï¼šæ‹–æ‹‰æ‹¼å­—'
            };
            document.getElementById('stageInfo').textContent = stageNames[stage];
            document.getElementById('pageTitle').textContent = stageNames[stage];
            
            // é¡¯ç¤ºé¡Œç›®
            if (stage === 1) {
                document.getElementById('questionWord').textContent = question.word;
            } else if (stage === 2) {
                document.getElementById('questionWord').textContent = question.meaning;
            } else if (stage === 3) {
                document.getElementById('questionWord').textContent = question.meaning;
            }
            
            // æ ¹æ“šéšæ®µé¡¯ç¤ºä¸åŒä»‹é¢
            if (stage === 3) {
                // æ‹¼å­—éšæ®µ
                document.getElementById('optionsContainer').classList.add('hidden');
                document.getElementById('spellingContainer').classList.remove('hidden');
                setupSpellingMode();
            } else {
                // é¸æ“‡é¡Œéšæ®µ
                document.getElementById('optionsContainer').classList.remove('hidden');
                document.getElementById('spellingContainer').classList.add('hidden');
                setupMultipleChoice();
            }
            
            // éš±è—ä¸‹ä¸€é¡ŒæŒ‰éˆ•å’Œå›é¥‹è¨Šæ¯
            document.getElementById('nextBtn').classList.add('hidden');
            document.getElementById('feedbackMessage').classList.add('hidden');
            selectedAnswer = null;
            
            // æ›´æ–°éµç›¤æç¤º
            updateKeyboardHint();
        }

        function setupMultipleChoice() {
            const question = questions[currentQuestionIndex];
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'bg-gray-50 hover:bg-blue-50 border-2 border-gray-200 hover:border-blue-400 p-4 rounded-xl text-lg font-semibold transition-all transform hover:scale-105 flex items-center justify-between';
                button.innerHTML = `
                    <span>${option}</span>
                    <button class="bg-blue-500 hover:bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center ml-2 transition-all">ğŸ”Š</button>
                `;
                
                // è¨­ç½®ä¸»æŒ‰éˆ•é»æ“Šäº‹ä»¶
                button.onclick = () => selectAnswer(index, option);
                
                // è¨­ç½®ç™¼éŸ³æŒ‰éˆ•é»æ“Šäº‹ä»¶
                const speakBtn = button.querySelector('button');
                speakBtn.onclick = (event) => {
                    event.stopPropagation();
                    if (question.stage === 1) {
                        // éšæ®µä¸€ï¼šè‹±æ–‡é¸ä¸­æ–‡ï¼Œæ‰¾åˆ°å°æ‡‰çš„è‹±æ–‡å–®å­—ä¾†ç™¼éŸ³
                        const vocabItem = vocabulary.find(v => v.meaning === option);
                        if (vocabItem) {
                            speakText(vocabItem.word);
                        }
                    } else if (question.stage === 2) {
                        // éšæ®µäºŒï¼šä¸­æ–‡é¸è‹±æ–‡ï¼Œç™¼éŸ³æ‰€æœ‰è‹±æ–‡é¸é …
                        speakText(option);
                    }
                };
                container.appendChild(button);
            });
        }

        function selectAnswer(index, answer) {
            if (selectedAnswer !== null) return;
            
            selectedAnswer = answer;
            const question = questions[currentQuestionIndex];
            const buttons = document.querySelectorAll('#optionsContainer button');
            const isCorrect = answer === question.correctAnswer;
            
            buttons.forEach((button, i) => {
                if (i === index) {
                    if (isCorrect) {
                        button.className = button.className.replace('bg-gray-50 hover:bg-blue-50 border-gray-200 hover:border-blue-400', 'bg-green-100 border-green-500');
                        score++;
                        stageScores[question.stage - 1]++;
                    } else {
                        button.className = button.className.replace('bg-gray-50 hover:bg-blue-50 border-gray-200 hover:border-blue-400', 'bg-red-100 border-red-500');
                    }
                } else if (button.textContent.includes(question.correctAnswer)) {
                    button.className = button.className.replace('bg-gray-50 hover:bg-blue-50 border-gray-200 hover:border-blue-400', 'bg-green-100 border-green-500');
                }
                button.onclick = null;
            });
            
            // é¡¯ç¤ºç­”é¡Œçµæœè¨Šæ¯
            showAnswerFeedback(isCorrect, question);
            
            document.getElementById('nextBtn').classList.remove('hidden');
            updateKeyboardHint();
        }

        // é¡¯ç¤ºç­”é¡Œçµæœå›é¥‹
        function showAnswerFeedback(isCorrect, question) {
            const feedbackDiv = document.getElementById('feedbackMessage');
            feedbackDiv.classList.remove('hidden');
            
            if (isCorrect) {
                feedbackDiv.innerHTML = `
                    <div class="bg-green-50 border-2 border-green-200 rounded-2xl p-6 max-w-md mx-auto">
                        <div class="text-4xl mb-2">ğŸ‰</div>
                        <div class="text-2xl font-bold text-green-600 mb-2">ç­”å°äº†ï¼</div>
                        <div class="text-lg text-gray-700">
                            <strong>${question.word}</strong> = ${question.meaning}
                        </div>
                    </div>
                `;
            } else {
                feedbackDiv.innerHTML = `
                    <div class="bg-red-50 border-2 border-red-200 rounded-2xl p-6 max-w-md mx-auto">
                        <div class="text-4xl mb-2">ğŸ˜”</div>
                        <div class="text-2xl font-bold text-red-600 mb-2">ç­”éŒ¯äº†</div>
                        <div class="text-lg text-gray-700 mb-2">
                            æ­£ç¢ºç­”æ¡ˆï¼š<span class="font-bold text-green-600">${question.correctAnswer}</span>
                        </div>
                        <div class="text-sm text-gray-600">
                            <strong>${question.word}</strong> = ${question.meaning}
                        </div>
                    </div>
                `;
            }
        }

        // æ‹¼å­—åŠŸèƒ½
        function setupSpellingMode() {
            const question = questions[currentQuestionIndex];
            const correctWord = question.word.toLowerCase();
            
            // é‡ç½®ç‹€æ…‹
            currentAnswer = [];
            
            // é‡ç½®æŒ‰éˆ•ç‹€æ…‹
            const checkBtn = document.getElementById('checkBtn');
            checkBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            checkBtn.onclick = checkSpelling;
            
            const clearBtn = document.querySelector('button[onclick="clearAnswer()"]');
            if (clearBtn) {
                clearBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                clearBtn.onclick = clearAnswer;
            }
            
            // é‡ç½®ç­”æ¡ˆå€åŸŸæ¨£å¼
            const answerArea = document.getElementById('answerArea');
            answerArea.className = 'answer-area min-h-20 bg-gray-50 border-3 border-dashed border-gray-300 rounded-2xl p-6 mb-6 flex items-center justify-center gap-2 flex-wrap transition-all';
            
            // ç”Ÿæˆå­—æ¯å¡ç‰‡
            const correctLetters = correctWord.split('');
            const distractorLetters = ['a', 'e', 'i', 'o', 'u', 'r', 's', 't', 'n', 'l', 'm', 'c', 'h', 'd'];
            
            const usedDistractors = distractorLetters
                .filter(letter => !correctLetters.includes(letter))
                .sort(() => Math.random() - 0.5)
                .slice(0, Math.min(6, 12 - correctLetters.length));
            
            availableLetters = [...correctLetters, ...usedDistractors]
                .sort(() => Math.random() - 0.5);
            
            // æ›´æ–°æç¤ºè³‡è¨Š
            document.getElementById('letterCount').textContent = correctLetters.length;
            document.getElementById('selectedCount').textContent = '0';
            
            createLetterCards();
            updateAnswerArea();
            setupDragAndDrop();
        }

        function createLetterCards() {
            const container = document.getElementById('letterCards');
            container.innerHTML = '';
            
            availableLetters.forEach((letter, index) => {
                const card = document.createElement('div');
                card.className = 'letter-card bg-gradient-to-br from-blue-500 to-purple-600 text-white font-bold px-4 py-3 rounded-xl shadow-lg cursor-pointer select-none';
                card.textContent = letter;
                card.draggable = true;
                card.dataset.letter = letter;
                card.dataset.index = index;
                card.id = `card-${index}`;
                
                // é»æ“Šé¸æ“‡
                card.onclick = () => selectLetter(index);
                
                container.appendChild(card);
            });
        }

        function setupDragAndDrop() {
            const answerArea = document.getElementById('answerArea');
            const cards = document.querySelectorAll('.letter-card');
            
            // è¨­ç½®æ‹–æ‹‰äº‹ä»¶
            cards.forEach(card => {
                card.addEventListener('dragstart', function(e) {
                    if (this.classList.contains('opacity-50')) {
                        e.preventDefault();
                        return;
                    }
                    this.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', this.dataset.index);
                });
                
                card.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                });
            });
            
            // è¨­ç½®æ”¾ç½®å€åŸŸ
            answerArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('drag-over');
            });
            
            answerArea.addEventListener('dragleave', function() {
                this.classList.remove('drag-over');
            });
            
            answerArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                const cardIndex = parseInt(e.dataTransfer.getData('text/plain'));
                selectLetter(cardIndex);
            });
        }

        function selectLetter(cardIndex) {
            if (selectedAnswer !== null) return;
            
            const card = document.getElementById(`card-${cardIndex}`);
            if (!card || card.classList.contains('opacity-50')) return;
            
            const letter = availableLetters[cardIndex];
            
            // æ·»åŠ åˆ°ç­”æ¡ˆ
            currentAnswer.push({
                letter: letter,
                originalIndex: cardIndex
            });
            
            // ç¦ç”¨å¡ç‰‡
            card.classList.add('opacity-50', 'cursor-not-allowed');
            card.onclick = null;
            card.draggable = false;
            
            updateAnswerArea();
            document.getElementById('selectedCount').textContent = currentAnswer.length;
            updateKeyboardHint();
        }

        function updateAnswerArea() {
            const answerArea = document.getElementById('answerArea');
            answerArea.innerHTML = '';
            
            if (currentAnswer.length === 0) {
                const hint = document.createElement('div');
                hint.className = 'text-gray-400 text-lg';
                hint.textContent = 'å°‡å­—æ¯å¡ç‰‡æ‹–æ‹‰åˆ°é€™è£¡';
                answerArea.appendChild(hint);
            } else {
                currentAnswer.forEach((item, index) => {
                    const answerCard = document.createElement('div');
                    answerCard.className = 'bg-gradient-to-br from-green-500 to-blue-600 text-white font-bold px-4 py-3 rounded-xl shadow-lg cursor-pointer select-none bounce';
                    answerCard.textContent = item.letter;
                    answerCard.onclick = () => removeLetter(index);
                    answerArea.appendChild(answerCard);
                });
            }
        }

        function removeLetter(answerIndex) {
            if (selectedAnswer !== null) return;
            
            const removedItem = currentAnswer[answerIndex];
            currentAnswer.splice(answerIndex, 1);
            
            // é‡æ–°å•Ÿç”¨åŸå¡ç‰‡
            const originalCard = document.getElementById(`card-${removedItem.originalIndex}`);
            if (originalCard) {
                originalCard.classList.remove('opacity-50', 'cursor-not-allowed');
                originalCard.onclick = () => selectLetter(removedItem.originalIndex);
                originalCard.draggable = true;
            }
            
            updateAnswerArea();
            document.getElementById('selectedCount').textContent = currentAnswer.length;
            updateKeyboardHint();
        }

        function clearAnswer() {
            if (selectedAnswer !== null) return;
            
            // é‡æ–°å•Ÿç”¨æ‰€æœ‰å¡ç‰‡
            currentAnswer.forEach(item => {
                const card = document.getElementById(`card-${item.originalIndex}`);
                if (card) {
                    card.classList.remove('opacity-50', 'cursor-not-allowed');
                    card.onclick = () => selectLetter(item.originalIndex);
                    card.draggable = true;
                }
            });
            
            currentAnswer = [];
            updateAnswerArea();
            document.getElementById('selectedCount').textContent = '0';
        }

        function checkSpelling() {
            if (selectedAnswer !== null || currentAnswer.length === 0) return;
            
            const question = questions[currentQuestionIndex];
            const userAnswer = currentAnswer.map(item => item.letter).join('').toLowerCase();
            const correctAnswer = question.word.toLowerCase();
            
            selectedAnswer = userAnswer;
            
            const answerArea = document.getElementById('answerArea');
            
            // æ¸…é™¤ä¹‹å‰çš„å…§å®¹ï¼Œé‡æ–°é¡¯ç¤ºç­”æ¡ˆ
            answerArea.innerHTML = '';
            
            if (userAnswer === correctAnswer) {
                answerArea.className = 'answer-area min-h-20 bg-green-50 border-3 border-dashed border-green-500 rounded-2xl p-6 mb-6 flex items-center justify-center gap-2 flex-wrap transition-all';
                score++;
                stageScores[question.stage - 1]++;
                
                // é¡¯ç¤ºæ­£ç¢ºçš„ç­”æ¡ˆ
                currentAnswer.forEach((item) => {
                    const answerCard = document.createElement('div');
                    answerCard.className = 'bg-gradient-to-br from-green-500 to-green-600 text-white font-bold px-4 py-3 rounded-xl shadow-lg select-none';
                    answerCard.textContent = item.letter;
                    answerArea.appendChild(answerCard);
                });
                
                const successMsg = document.createElement('div');
                successMsg.className = 'text-green-600 font-bold mt-2 w-full text-center';
                successMsg.textContent = 'âœ… ç­”å°äº†ï¼';
                answerArea.appendChild(successMsg);
                
            } else {
                answerArea.className = 'answer-area min-h-20 bg-red-50 border-3 border-dashed border-red-500 rounded-2xl p-6 mb-6 flex items-center justify-center gap-2 flex-wrap transition-all';
                
                // é¡¯ç¤ºç”¨æˆ¶çš„éŒ¯èª¤ç­”æ¡ˆ
                currentAnswer.forEach((item) => {
                    const answerCard = document.createElement('div');
                    answerCard.className = 'bg-gradient-to-br from-red-500 to-red-600 text-white font-bold px-4 py-3 rounded-xl shadow-lg select-none';
                    answerCard.textContent = item.letter;
                    answerArea.appendChild(answerCard);
                });
                
                // é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆ
                const correctAnswerDiv = document.createElement('div');
                correctAnswerDiv.className = 'text-red-600 font-bold mt-2 w-full text-center';
                correctAnswerDiv.innerHTML = `âŒ æ­£ç¢ºç­”æ¡ˆï¼š<span class="text-green-600">${correctAnswer}</span>`;
                answerArea.appendChild(correctAnswerDiv);
            }
            
            // ç¦ç”¨æ‰€æœ‰æ“ä½œ
            document.getElementById('checkBtn').classList.add('opacity-50', 'cursor-not-allowed');
            document.getElementById('checkBtn').onclick = null;
            
            const cards = document.querySelectorAll('.letter-card');
            cards.forEach(card => {
                card.onclick = null;
                card.draggable = false;
            });
            
            // ç¦ç”¨æ¸…é™¤æŒ‰éˆ•
            const clearBtn = document.querySelector('button[onclick="clearAnswer()"]');
            if (clearBtn) {
                clearBtn.classList.add('opacity-50', 'cursor-not-allowed');
                clearBtn.onclick = null;
            }
            
            document.getElementById('nextBtn').classList.remove('hidden');
            updateKeyboardHint();
        }

        function nextQuestion() {
            currentQuestionIndex++;
            
            if (currentQuestionIndex < questions.length) {
                displayQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            document.getElementById('quizArea').classList.add('hidden');
            document.getElementById('resultsPage').classList.remove('hidden');
            document.getElementById('pageTitle').textContent = 'æ¸¬é©—å®Œæˆï¼';
            
            // é¡¯ç¤ºç¸½åˆ†
            document.getElementById('finalScore').textContent = `${score}/${questions.length}`;
            
            const percentage = Math.round((score / questions.length) * 100);
            const scoreMessage = document.getElementById('scoreMessage');
            
            if (percentage === 100) {
                scoreMessage.textContent = 'å®Œç¾ï¼å…¨éƒ¨ç­”å°äº†ï¼ğŸ‰';
                scoreMessage.className = 'text-xl text-green-600';
            } else if (percentage >= 80) {
                scoreMessage.textContent = `å¾ˆæ£’ï¼ç­”å°äº† ${percentage}%ï¼ğŸ‘`;
                scoreMessage.className = 'text-xl text-green-600';
            } else if (percentage >= 60) {
                scoreMessage.textContent = `ä¸éŒ¯ï¼ç­”å°äº† ${percentage}%ï¼Œç¹¼çºŒåŠ æ²¹ï¼ğŸ’ª`;
                scoreMessage.className = 'text-xl text-yellow-600';
            } else {
                scoreMessage.textContent = `ç­”å°äº† ${percentage}%ï¼Œå¤šç·´ç¿’æœƒæ›´å¥½ï¼ğŸ“š`;
                scoreMessage.className = 'text-xl text-red-600';
            }
            
            // é¡¯ç¤ºå„éšæ®µæˆç¸¾
            const stageContainer = document.getElementById('stageScores');
            stageContainer.innerHTML = '';
            
            const stageNames = ['è‹±æ–‡é¸ä¸­æ–‡', 'ä¸­æ–‡é¸è‹±æ–‡', 'æ‹–æ‹‰æ‹¼å­—'];
            stageScores.forEach((stageScore, index) => {
                const stageDiv = document.createElement('div');
                stageDiv.className = 'bg-white p-4 rounded-xl border-2 border-gray-200';
                stageDiv.innerHTML = `
                    <div class="text-lg font-bold text-gray-700">${stageNames[index]}</div>
                    <div class="text-2xl font-bold ${stageScore >= 4 ? 'text-green-600' : stageScore >= 3 ? 'text-yellow-600' : 'text-red-600'}">${stageScore}/5</div>
                `;
                stageContainer.appendChild(stageDiv);
            });
        }

        function restartQuiz() {
            startQuiz();
        }

        // èªéŸ³åŠŸèƒ½
        function speakWord() {
            const question = questions[currentQuestionIndex];
            speakText(question.word);
        }

        function speakText(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        // æ›´æ–°éµç›¤æç¤º
        function updateKeyboardHint() {
            const nextBtn = document.getElementById('nextBtn');
            const checkBtn = document.getElementById('checkBtn');
            const keyboardHint = document.getElementById('keyboardHint');
            
            if (!nextBtn.classList.contains('hidden')) {
                keyboardHint.textContent = 'æŒ‰ç©ºç™½éµï¼šä¸‹ä¸€é¡Œ âŒ¨ï¸';
            } else if (!checkBtn.classList.contains('hidden') && !checkBtn.classList.contains('opacity-50') && currentAnswer.length > 0) {
                keyboardHint.textContent = 'æŒ‰ç©ºç™½éµï¼šç¢ºèªç­”æ¡ˆ âŒ¨ï¸';
            } else if (questions[currentQuestionIndex] && questions[currentQuestionIndex].stage === 3) {
                keyboardHint.textContent = 'æ‹–æ‹‰å­—æ¯æ‹¼å­— âŒ¨ï¸';
            } else {
                keyboardHint.textContent = 'é¸æ“‡ç­”æ¡ˆ âŒ¨ï¸';
            }
        }

        // éµç›¤å¿«æ·éµ
        document.addEventListener('keydown', function(event) {
            // å¦‚æœå¯†ç¢¼è¼¸å…¥æ¡†å¯è¦‹ï¼Œè™•ç† Enter éµ
            if (!document.getElementById('passwordModal').classList.contains('hidden')) {
                if (event.code === 'Enter') {
                    confirmPassword();
                } else if (event.code === 'Escape') {
                    cancelPassword();
                }
                return;
            }
            
            // ç©ºç™½éµï¼šä¸‹ä¸€é¡Œæˆ–ç¢ºèªç­”æ¡ˆ
            if (event.code === 'Space') {
                event.preventDefault(); // é˜²æ­¢é é¢æ»¾å‹•
                
                const nextBtn = document.getElementById('nextBtn');
                const checkBtn = document.getElementById('checkBtn');
                
                // å¦‚æœä¸‹ä¸€é¡ŒæŒ‰éˆ•å¯è¦‹ï¼ŒåŸ·è¡Œä¸‹ä¸€é¡Œ
                if (!nextBtn.classList.contains('hidden')) {
                    nextQuestion();
                }
                // å¦‚æœæ˜¯æ‹¼å­—éšæ®µä¸”ç¢ºèªæŒ‰éˆ•å¯ç”¨ä¸”æœ‰é¸æ“‡å­—æ¯ï¼ŒåŸ·è¡Œç¢ºèªç­”æ¡ˆ
                else if (!checkBtn.classList.contains('hidden') && !checkBtn.classList.contains('opacity-50') && currentAnswer.length > 0) {
                    checkSpelling();
                }
            }
        });

        // åˆå§‹åŒ–
        showHome();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9966c1e7d456843a',t:'MTc2MTc4MzczNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
